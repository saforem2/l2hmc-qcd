<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sam Foreman ">
<meta name="dcterms.date" content="2023-10-04">

<title>l2hmc-qcd - 2D U(1) Example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/bootstrap-icons-1.9.1/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XVM2Y822Y1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XVM2Y822Y1', { 'anonymize_ip': true});
</script>
<link href="https://pvinis.github.io/iosevka-webfont/3.4.1/iosevka.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../css/default.css">
<link rel="stylesheet" href="../css/callouts.css">
<link rel="stylesheet" href="../css/profile.css">
<meta property="og:title" content="l2hmc-qcd - 2D U(1) Example">
<meta property="og:image" content="http://img.shields.io/badge/arXiv-2105.03418-B31B1B.svg">
<meta property="og:site-name" content="l2hmc-qcd">
<meta name="twitter:title" content="l2hmc-qcd - 2D U(1) Example">
<meta name="twitter:image" content="http://img.shields.io/badge/arXiv-2105.03418-B31B1B.svg">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="2D $U(1)$ Model">
<meta name="citation_author" content="Sam Foreman">
<meta name="citation_publication_date" content="2023-10-04">
<meta name="citation_cover_date" content="2023-10-04">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2023-10-04">
<meta name="citation_fulltext_html_url" content="https://saforem2.github.io/l2hmc-qcd/qmd/l2hmc-4DSU3.html">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=The climate risk &amp;amp;amp; resilience portal (ClimRR) metadata and data dictionary;,citation_author=C. Burdi;,citation_author=Wall. T Branham;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://dub.sh/ClimRR-Metadata;">
<meta name="citation_reference" content="citation_title=Progress on (g-2)_\mu from lattice QCD;,citation_author=Hartmut Wittig;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2306.04165;">
<meta name="citation_reference" content="citation_title=Hybrid Monte Carlo;,citation_author=S. Duane;,citation_author=A. D. Kennedy;,citation_author=B. J. Pendleton;,citation_author=D. Roweth;,citation_publication_date=1987;,citation_cover_date=1987;,citation_year=1987;,citation_doi=10.1016/0370-2693(87)91197-X;,citation_volume=195;,citation_journal_title=Phys. Lett. B;">
<meta name="citation_reference" content="citation_title=Snowmass 2021 Computational Frontier CompF03 Topical Group Report: Machine Learning;,citation_author=Phiala Shanahan;,citation_author=others;,citation_publication_date=2022-09;,citation_cover_date=2022-09;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2209.07559;">
<meta name="citation_reference" content="citation_title=Applications of Machine Learning to Lattice Quantum Field Theory;,citation_author=Denis Boyda;,citation_author=others;,citation_publication_date=2022-02;,citation_cover_date=2022-02;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2202.05838;,citation_conference_title=Snowmass 2021;">
<meta name="citation_reference" content="citation_title=HMC with Normalizing Flows;,citation_author=Sam Foreman;,citation_author=Taku Izubuchi;,citation_author=Luchang Jin;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_author=Akio Tomiya;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01586;,citation_doi=10.22323/1.396.0073;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=LeapfrogLayers: A Trainable Framework for Effective Topological Sampling;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2112.01582;,citation_doi=10.22323/1.396.0508;,citation_volume=LATTICE2021;,citation_journal_title=PoS;">
<meta name="citation_reference" content="citation_title=Deep Learning Hamiltonian Monte Carlo;,citation_author=Sam Foreman;,citation_author=Xiao-Yong Jin;,citation_author=James C. Osborn;,citation_publication_date=2021-05;,citation_cover_date=2021-05;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2105.03418;,citation_conference_title=9th International Conference on Learning Representations;">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src=".././assets/logo-crop.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">l2hmc-qcd</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../qmd/posts.html" rel="" target="">
 <span class="menu-text"><span class="red-text"><i class="bi-signpost-split " style="" role="img" aria-hidden="true"></i></span> Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../qmd/slides.html" rel="" target="">
 <span class="menu-text"><span class="green-text"><i class="bi-easel " style="" role="img" aria-hidden="true"></i></span> Talks</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/saforem2/l2hmc-qcd" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#l2hmc-qcd-2d-u1-example" id="toc-l2hmc-qcd-2d-u1-example" class="nav-link active" data-scroll-target="#l2hmc-qcd-2d-u1-example"><code>l2hmc-qcd</code>: 2D <span class="math inline">U(1)</span> Example</a>
  <ul class="collapse">
  <li><a href="#contents" id="toc-contents" class="nav-link" data-scroll-target="#contents">Contents</a></li>
  </ul></li>
  <li><a href="#l2hmc-example" id="toc-l2hmc-example" class="nav-link" data-scroll-target="#l2hmc-example"><code>l2hmc</code>: Example</a></li>
  <li><a href="#imports-setup" id="toc-imports-setup" class="nav-link" data-scroll-target="#imports-setup">Imports / Setup</a></li>
  <li><a href="#initialize-and-build-experiment-objects" id="toc-initialize-and-build-experiment-objects" class="nav-link" data-scroll-target="#initialize-and-build-experiment-objects">Initialize and Build <code>Experiment</code> objects:</a></li>
  <li><a href="#pytorch" id="toc-pytorch" class="nav-link" data-scroll-target="#pytorch">PyTorch</a></li>
  <li><a href="#training" id="toc-training" class="nav-link" data-scroll-target="#training">Training</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  <li><a href="#tensorflow" id="toc-tensorflow" class="nav-link" data-scroll-target="#tensorflow">TensorFlow</a></li>
  <li><a href="#train" id="toc-train" class="nav-link" data-scroll-target="#train">Train</a></li>
  <li><a href="#inference-1" id="toc-inference-1" class="nav-link" data-scroll-target="#inference-1">Inference</a></li>
  <li><a href="#model-performance" id="toc-model-performance" class="nav-link" data-scroll-target="#model-performance">Model Performance</a></li>
  <li><a href="#comparisons" id="toc-comparisons" class="nav-link" data-scroll-target="#comparisons">Comparisons</a></li>
  <li><a href="#tensorflow-results" id="toc-tensorflow-results" class="nav-link" data-scroll-target="#tensorflow-results">TensorFlow Results</a></li>
  <li><a href="#pytorch-results" id="toc-pytorch-results" class="nav-link" data-scroll-target="#pytorch-results">PyTorch Results</a></li>
  <li><a href="#comparisons-1" id="toc-comparisons-1" class="nav-link" data-scroll-target="#comparisons-1">Comparisons</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/saforem2/l2hmc-qcd/blob/main/qmd/l2hmc-2DU1.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/saforem2/l2hmc-qcd/edit/main/qmd/l2hmc-2DU1.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/saforem2/l2hmc-qcd/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">2D <span class="math inline">U(1)</span> Example</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/saforem2/l2hmc-qcd/blob/main/qmd/l2hmc-2DU1.qmd"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading"></div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://samforeman.me">Sam Foreman </a><a href="https://orcid.org/0000-0002-9981-0876"><span class="orcid-green"><i class="ai  ai-orcid"></i></span></a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading"></div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="l2hmc-qcd-2d-u1-example" class="level1">
<h1><code>l2hmc-qcd</code>: 2D <span class="math inline">U(1)</span> Example</h1>
<section id="contents" class="level2">
<h2 class="anchored" data-anchor-id="contents">Contents</h2>
<ul>
<li><a href="#l2hmc-example"><code>l2hmc</code>: Example</a></li>
<li><a href="#imports--setup">Imports / Setup</a></li>
<li><a href="#initialize-and-build-experiment-objects">Initialize and Build <code>Experiment</code> objects:</a></li>
<li><a href="#pytorch">PyTorch</a></li>
<li><a href="#training">Training</a></li>
<li><a href="#inference">Inference</a></li>
<li><a href="#tensorflow">TensorFlow</a></li>
<li><a href="#train">Train</a></li>
<li><a href="#inference">Inference</a></li>
<li><a href="#model-performance">Model Performance</a></li>
<li><a href="#comparisons">Comparisons</a></li>
<li><a href="#tensorflow-results">TensorFlow Results</a></li>
<li><a href="#pytorch-results">PyTorch Results</a></li>
<li><a href="#comparisons">Comparisons</a></li>
</ul>
</section>
</section>
<div id="dcdb0796-c07d-495d-98c1-082a61990ee7" class="cell markdown">
<section id="l2hmc-example" class="level1">
<h1><code>l2hmc</code>: Example</h1>
<p><a href="https://arxiv.org/abs/2105.03418"><img alt="arxiv" src="http://img.shields.io/badge/arXiv-2105.03418-B31B1B.svg" align="left"></a> <a href="https://arxiv.org/abs/2112.01582"><img alt="arxiv" src="http://img.shields.io/badge/arXiv-2112.01582-B31B1B.svg" align="left" style="margin-left:10px;"></a><br></p>
<p>This notebook will (attempt) to walk through the steps needed to successfully instantiate and “run” an experiment.</p>
<p>For this example, we wish to train the L2HMC sampler for the 2D <span class="math inline">U(1)</span> lattice gauge model with Wilson action:</p>
<p><span class="math display">\begin{equation*}
S_{\beta}(n) = \beta \sum_{n}\sum_{\mu&lt;\nu}\mathrm{Re}\left[1 - U_{\mu\nu}(n) \right]
\end{equation*}</span></p>
<p>This consists of the following steps:</p>
<ol type="1">
<li>Build an <code>Experiment</code> by parsing our configuration object</li>
<li>Train our model using the <code>Experiment.train()</code> method</li>
<li>Evaluate our trained model <code>Experiment.evaluate(job_type='eval')</code></li>
<li>Compare our trained models’ performance against generic HMC <code>Experiment.evaluate(job_type='hmc')</code></li>
</ol>
<div class="alert alert-block alert-info" style="background:rgba(102, 102, 102, 0.1);color:#666666; border-radius:5px; border: none;">
<span style="font-weight:700; font-size:1.5em;">Evaluating Performance</span>
Explicitly, we measure the performance of our model by comparing the <em>tunneling rate</em> <span class="math inline">\delta Q</span> of our <strong>trained</strong> sampler to that of generic HMC.
Explicitly, the tunneling rate is given by:
<span class="math display">
\delta Q = \frac{1}{N_{\mathrm{chains}}}\sum_{\mathrm{chains}} \left|Q_{i+1} - Q_{i}\right|
</span>
where the difference is between subsequent states in a chain, and the sum is over all <span class="math inline">N</span> chains (each being ran in parallel, <em>independently</em>).
Since our goal is to generate <em>independent configurations</em>, the more our sampler tunnels between different topological sectors (<em>tunneling rate</em>), the more efficient our sampler.

</div>
</section>
</div>
<div id="1cc8525c-002e-47b1-b874-a86da659d7d3" class="cell markdown">
<section id="imports-setup" class="level2">
<h2 class="anchored" data-anchor-id="imports-setup">Imports / Setup</h2>
</section>
</div>
<div id="6ae28c5b-b124-436f-bc93-633f0f2e5d00" class="cell code" data-tags="[]">
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> nvidia<span class="op">-</span>smi <span class="op">|</span> tail <span class="op">--</span>lines <span class="op">-</span><span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="269e6cc2-4d68-40c1-8809-98ecb590f40f" class="cell code" data-execution_count="1" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:55:29.625997Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:55:29.625355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:55:36.426583Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:55:36.425961Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:55:29.625976Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically detect and reload local changes to modules</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'COLORTERM'</span>] <span class="op">=</span> <span class="st">'truecolor'</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># BE SURE TO GRAB A FRESH GPU !</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'CUDA_VISIBLE_DEVICES'</span>] <span class="op">=</span> <span class="st">'2'</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>echo $CUDA_VISIBLE_DEVICES</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>2</code></pre>
</div>
</div>
<div id="0421d8de-d2ee-47a6-bd36-35b3e2d32700" class="cell code" data-execution_count="2" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:55:36.428548Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:55:36.427922Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:55:36.702843Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:55:36.702225Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:55:36.428530Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>devices <span class="op">=</span> os.environ.get(<span class="st">'CUDA_VISIBLE_DEVICES'</span>, <span class="va">None</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(devices)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>getconf _NPROCESSORS_ONLN  <span class="co"># get number of availble CPUs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>2
256</code></pre>
</div>
</div>
<div id="72a4b488-e32d-4b33-8c4d-6a570fbd7b21" class="cell code" data-execution_count="3" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:55:36.703921Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:55:36.703700Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:55:36.979382Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:55:36.978760Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:55:36.703904Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'TORCH_CPP_LOG_LEVEL'</span>] <span class="op">=</span> <span class="st">'ERROR'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'AUTOGRAPH_VERBOSITY'</span>] <span class="op">=</span> <span class="st">'10'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>echo $CUDA_VISIBLE_DEVICES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>2</code></pre>
</div>
</div>
<div id="23d9a5d7-45db-47e8-b108-90e65306149b" class="cell code" data-execution_count="4" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:55:36.980565Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:55:36.980240Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:55:51.889407Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:55:51.889107Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:55:36.980547Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> __future__ <span class="im">import</span> absolute_import, print_function, annotations, division</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.main <span class="im">import</span> build_experiment</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.utils.rich <span class="im">import</span> get_console</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.utils.plot_helpers <span class="im">import</span> set_plot_style</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>set_plot_style()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'grid.alpha'</span>] <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'grid.color'</span>] <span class="op">=</span> <span class="st">'#404040'</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(rc<span class="op">=</span>{<span class="st">"figure.dpi"</span>:<span class="dv">100</span>, <span class="st">'savefig.dpi'</span>:<span class="dv">300</span>})</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'notebook'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"ticks"</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>set_matplotlib_formats(<span class="st">'retina'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> [<span class="fl">12.4</span>, <span class="fl">4.8</span>]</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>console <span class="op">=</span> get_console()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(console.is_jupyter)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> console.is_jupyter:</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    console.is_jupyter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(console.is_jupyter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stderr">
<pre><code>--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   thetagpu23
  Local device: mlx5_0
--------------------------------------------------------------------------</code></pre>
</div>
<div class="output display_data">
<pre><code>True</code></pre>
</div>
<div class="output stream stdout">
<pre><code>False</code></pre>
</div>
</div>
<div id="670564b9-ff83-4e4c-ae7a-1652475aec90" class="cell code" data-execution_count="5" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:55:51.891183Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:55:51.890729Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:55:51.929480Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:55:51.929290Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:55:51.891167Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> l2hmc</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>l2hmc.<span class="va">__file__</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output execute_result" data-execution_count="5">
<pre><code>'/lus/grand/projects/DLHMC/foremans/locations/thetaGPU/projects/l2hmc-qcd/src/l2hmc/__init__.py'</code></pre>
</div>
</div>
<div id="45f19b57-8513-4102-8f5d-2d3e1b6110c7" class="cell markdown">
<section id="initialize-and-build-experiment-objects" class="level1">
<h1>Initialize and Build <code>Experiment</code> objects:</h1>
<ul>
<li>The <code>l2hmc.main</code> module provides a function <code>build_experiment</code>:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_experiment(overrides: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> tfExperiment <span class="op">|</span> ptExperiment:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which will:</p>
<ol type="1">
<li>Load the default options from <code>conf/config.yaml</code></li>
<li>Override the default options with any values provided in <code>overrides</code></li>
<li>Parse these options and build an <code>ExperimentConfig</code> which uniquely defines an experiment</li>
<li>Instantiate / return an <code>Experiment</code> from the <code>ExperimentConfig</code>. Depending on <code>framework=pytorch|tensorflow</code>: a. <code>framework=pytorch</code> -&gt; <code>l2hmc.experiment.pytorch.Experiment</code> b. <code>framework=tensorflow</code> -&gt; <code>l2hmc.experiment.tensorflow.Experiment</code></li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> train_output <span class="op">=</span> experiment.train()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> eval_output <span class="op">=</span> experiment.evaluate(job_type<span class="op">=</span><span class="st">'eval'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> hmc_output <span class="op">=</span> experiment.evaluate(job_type<span class="op">=</span><span class="st">'hmc'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="alert alert-block alert-info" style="background:rgba(102, 102, 102, 0.2);color:rgb(102,102,102); border-radius:5px; border:none">
<p><b><u>Overriding Defaults</u></b>
Specifics about the training / evaluation / hmc runs can be flexibly overridden by passing arguments to the training / evaluation / hmc runs, respectively</p>
</div>
</section>
</div>
<div id="4a748bf6-2c57-4e5a-8f1b-45d22b17eb89" class="cell code" data-execution_count="6" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:57:47.150216Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:57:47.149780Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:57:47.189337Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:57:47.189085Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:57:47.150199Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#seed = np.random.randint(100000)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>seed<span class="op">=</span><span class="dv">76043</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>DEFAULTS <span class="op">=</span> {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'seed'</span>: <span class="ss">f'</span><span class="sc">{</span>seed<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precision'</span>: <span class="st">'fp16'</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'init_aim'</span>: <span class="va">False</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'init_wandb'</span>: <span class="va">False</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'use_wandb'</span>: <span class="va">False</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'restore'</span>: <span class="va">False</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'save'</span>: <span class="va">False</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'use_tb'</span>: <span class="va">False</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'dynamics'</span>: {</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nleapfrog'</span>: <span class="dv">10</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nchains'</span>: <span class="dv">4096</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'eps'</span>: <span class="fl">0.05</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'conv'</span>: <span class="st">'none'</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'steps'</span>: {</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log'</span>: <span class="dv">20</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'print'</span>: <span class="dv">250</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nepoch'</span>: <span class="dv">5000</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nera'</span>: <span class="dv">1</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'annealing_schedule'</span>: {</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'beta_init'</span>: <span class="fl">4.0</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'beta_final'</span>: <span class="fl">4.0</span>,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'learning_rate': {</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    #'lr_init': 0.0005,</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    #'clip_norm': 10.0,</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#},</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> {</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pytorch'</span>: {</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'train'</span>: {},</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'eval'</span>: {},</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'hmc'</span>: {},</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tensorflow'</span>: {</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">'train'</span>: {},</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">'eval'</span>: {},</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'hmc'</span>: {},</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5c3e44b1-81ae-479d-81dd-a2394fcb746e" class="cell code" data-execution_count="7" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:57:48.851215Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:57:48.850786Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:57:48.938467Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:57:48.938288Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:57:48.851199Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.configs <span class="im">import</span> dict_to_list_of_overrides</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>OVERRIDES <span class="op">=</span> dict_to_list_of_overrides(DEFAULTS)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>OVERRIDES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output execute_result" data-execution_count="7">
<pre><code>['seed=76043',
 'precision=fp16',
 'init_aim=False',
 'init_wandb=False',
 'use_wandb=False',
 'restore=False',
 'save=False',
 'use_tb=False',
 'dynamics.nleapfrog=10',
 'dynamics.nchains=4096',
 'dynamics.eps=0.05',
 'conv=none',
 'steps.log=20',
 'steps.print=250',
 'steps.nepoch=5000',
 'steps.nera=1',
 'annealing_schedule.beta_init=4.0',
 'annealing_schedule.beta_final=4.0']</code></pre>
</div>
</div>
<div id="bb61d780-df25-41a4-b4d7-1b1f679a7077" class="cell code" data-execution_count="8" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:57:49.004189Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:57:49.003894Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:58:17.737951Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:58:17.737527Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:57:49.004174Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build PyTorch Experiment</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ptExpU1 <span class="op">=</span> build_experiment(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    overrides<span class="op">=</span>[</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>OVERRIDES,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'framework=pytorch'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'backend=DDP'</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 12:57:55][INFO][dist.py:338] - Global Rank: 0 / 0</code></pre>
</div>
<div class="output stream stderr">
<pre><code>2023-06-23 12:57:58.015160: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE3 SSE4.1 SSE4.2 AVX AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.</code></pre>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 12:58:15][INFO][dist.py:226] - Caught MASTER_PORT:2345 from environment!
[06/23/23 12:58:15][INFO][dist.py:226] - Caught MASTER_PORT:2345 from environment!
[06/23/23 12:58:15][WARNING][trainer.py:435] - Using torch.float16 on cuda!
[06/23/23 12:58:17][WARNING][trainer.py:435] - Using `torch.optim.Adam` optimizer
[06/23/23 12:58:17][INFO][trainer.py:283] - num_params in model: 1486740
[06/23/23 12:58:17][WARNING][trainer.py:250] - logging with freq 20 for wandb.watch</code></pre>
</div>
</div>
<div id="2572b684-4f3d-4344-acfe-e22d3d8a0cba" class="cell code" data-execution_count="9" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:58:17.739670Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:58:17.739149Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T17:58:19.356460Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T17:58:19.355981Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:58:17.739654Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build TensorFlow Experiment</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>tf.keras.mixed_precision.set_global_policy(<span class="st">'mixed_float16'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>tfExpU1 <span class="op">=</span> build_experiment(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    overrides<span class="op">=</span>[</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>OVERRIDES,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'framework=tensorflow'</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'backend=horovod'</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>INFO:tensorflow:Mixed precision compatibility check (mixed_float16): OK
Your GPU will likely run quickly with dtype policy mixed_float16 as it has compute capability of at least 7.0. Your GPU: NVIDIA A100-SXM4-80GB, compute capability 8.0
[06/23/23 12:58:18][INFO][dist.py:82] - 1, Physical GPUs and 1 Logical GPUs
[06/23/23 12:58:18][WARNING][dist.py:108] - Using: float32 precision
[06/23/23 12:58:18][INFO][dist.py:109] - RANK: 0, LOCAL_RANK: 0</code></pre>
</div>
</div>
<div id="a85fdffb-87f9-4ed1-b308-f7cc60b0b52a" class="cell markdown" data-tags="[]">
<section id="pytorch" class="level2">
<h2 class="anchored" data-anchor-id="pytorch">PyTorch</h2>
</section>
</div>
<div id="5e7cdf42-503b-4c68-8530-6b9456c10a3b" class="cell markdown">
<section id="training" class="level3">
<h3 class="anchored" data-anchor-id="training">Training</h3>
</section>
</div>
<div id="bffdcbcd-06d8-4db9-b372-0ea337ba8629" class="cell code" data-execution_count="10" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T17:58:19.357429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T17:58:19.357149Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T18:51:15.529944Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T18:51:15.529298Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T17:58:19.357413Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'pytorch'</span>][<span class="st">'train'</span>] <span class="op">=</span> ptExpU1.trainer.train()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#nera=5,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#nepoch=2000,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#beta=[4.0, 4.25, 4.5, 4.75, 5.0],</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ptExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'train'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output display_data">
<p><img src="assets/8272861d462b935cd19269560b692eb9277eba43.png" width="1108" height="395"></p>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 12:58:19][INFO][trainer.py:439] - [TRAINING] x.dtype: torch.float32
[06/23/23 12:58:19][INFO][trainer.py:439] - [TRAINING] self._dtype: torch.float16
[06/23/23 12:58:19][INFO][trainer.py:107] - ┏━━━━━━━━━━━━━━━━━━━━━━━━━┓
[06/23/23 12:58:19][INFO][trainer.py:108] - ┃ ERA: 0 / 1, BETA: 4.000 ┃
[06/23/23 12:58:19][INFO][trainer.py:109] - ┗━━━━━━━━━━━━━━━━━━━━━━━━━┛
[06/23/23 12:58:24][INFO][trainer.py:439] - Thermalizing configs @ 4.00 took 4.7326 s
[06/23/23 12:58:25][INFO][trainer.py:1722] - era=0 epoch=0 tstep=1 dt=0.781 beta=4.000 loss=59.439 dQsin=0.016 dQint=0.005 energy=398.887 logprob=398.650 logdet=0.237 sldf=0.143 sldb=-0.117 sld=0.237 xeps=0.050 veps=0.050 acc=0.057 sumlogdet=0.003 acc_mask=0.057 plaqs=0.864 intQ=0.009 sinQ=0.006 lr=0.001
[06/23/23 13:00:59][INFO][trainer.py:1722] - era=0 epoch=240 tstep=241 dt=0.600 beta=4.000 loss=-4.980 dQsin=0.212 dQint=0.069 energy=396.331 logprob=395.966 logdet=0.365 sldf=0.199 sldb=-0.146 sld=0.365 xeps=0.044 veps=0.043 acc=0.781 sumlogdet=-0.003 acc_mask=0.777 plaqs=0.864 intQ=-0.012 sinQ=-0.012 lr=0.001
[06/23/23 13:03:34][INFO][trainer.py:1722] - era=0 epoch=500 tstep=501 dt=0.599 beta=4.000 loss=-7.162 dQsin=0.239 dQint=0.084 energy=396.375 logprob=395.945 logdet=0.431 sldf=0.234 sldb=-0.186 sld=0.431 xeps=0.051 veps=0.050 acc=0.846 sumlogdet=0.002 acc_mask=0.851 plaqs=0.864 intQ=0.053 sinQ=0.049 lr=0.001
[06/23/23 13:06:07][INFO][trainer.py:1722] - era=0 epoch=740 tstep=741 dt=0.591 beta=4.000 loss=-8.272 dQsin=0.253 dQint=0.095 energy=396.330 logprob=395.886 logdet=0.444 sldf=0.243 sldb=-0.216 sld=0.444 xeps=0.052 veps=0.051 acc=0.872 sumlogdet=0.001 acc_mask=0.882 plaqs=0.864 intQ=0.013 sinQ=0.015 lr=0.001
[06/23/23 13:08:39][INFO][trainer.py:1722] - era=0 epoch=1000 tstep=1001 dt=0.594 beta=4.000 loss=-8.689 dQsin=0.246 dQint=0.092 energy=396.763 logprob=396.257 logdet=0.505 sldf=0.277 sldb=-0.258 sld=0.505 xeps=0.058 veps=0.056 acc=0.865 sumlogdet=0.002 acc_mask=0.861 plaqs=0.863 intQ=-0.037 sinQ=-0.038 lr=0.001
[06/23/23 13:11:12][INFO][trainer.py:1722] - era=0 epoch=1240 tstep=1241 dt=0.607 beta=4.000 loss=-8.190 dQsin=0.242 dQint=0.101 energy=396.304 logprob=395.726 logdet=0.578 sldf=0.316 sldb=-0.282 sld=0.578 xeps=0.065 veps=0.063 acc=0.840 sumlogdet=0.001 acc_mask=0.846 plaqs=0.864 intQ=-0.040 sinQ=-0.035 lr=0.001
[06/23/23 13:13:44][INFO][trainer.py:1722] - era=0 epoch=1500 tstep=1501 dt=0.592 beta=4.000 loss=-9.732 dQsin=0.238 dQint=0.121 energy=397.387 logprob=396.435 logdet=0.952 sldf=0.519 sldb=-0.430 sld=0.952 xeps=0.083 veps=0.078 acc=0.752 sumlogdet=0.002 acc_mask=0.748 plaqs=0.863 intQ=0.039 sinQ=0.035 lr=0.001
[06/23/23 13:16:17][INFO][trainer.py:1722] - era=0 epoch=1740 tstep=1741 dt=0.592 beta=4.000 loss=-10.209 dQsin=0.235 dQint=0.134 energy=397.590 logprob=396.320 logdet=1.271 sldf=0.692 sldb=-0.577 sld=1.271 xeps=0.094 veps=0.087 acc=0.725 sumlogdet=0.007 acc_mask=0.723 plaqs=0.864 intQ=0.005 sinQ=0.008 lr=0.001
[06/23/23 13:18:52][INFO][trainer.py:1722] - era=0 epoch=2000 tstep=2001 dt=0.599 beta=4.000 loss=-12.075 dQsin=0.234 dQint=0.149 energy=399.553 logprob=397.752 logdet=1.800 sldf=0.980 sldb=-0.801 sld=1.800 xeps=0.106 veps=0.094 acc=0.638 sumlogdet=0.005 acc_mask=0.633 plaqs=0.863 intQ=0.013 sinQ=0.007 lr=0.001
[06/23/23 13:21:25][INFO][trainer.py:1722] - era=0 epoch=2240 tstep=2241 dt=0.592 beta=4.000 loss=-13.515 dQsin=0.239 dQint=0.162 energy=399.697 logprob=397.477 logdet=2.220 sldf=1.209 sldb=-0.991 sld=2.220 xeps=0.114 veps=0.099 acc=0.616 sumlogdet=0.007 acc_mask=0.618 plaqs=0.863 intQ=0.005 sinQ=0.004 lr=0.001
[06/23/23 13:23:58][INFO][trainer.py:1722] - era=0 epoch=2500 tstep=2501 dt=0.591 beta=4.000 loss=-11.498 dQsin=0.216 dQint=0.155 energy=400.518 logprob=397.818 logdet=2.700 sldf=1.470 sldb=-1.218 sld=2.700 xeps=0.125 veps=0.104 acc=0.538 sumlogdet=0.010 acc_mask=0.541 plaqs=0.863 intQ=-0.033 sinQ=-0.027 lr=0.001
[06/23/23 13:26:30][INFO][trainer.py:1722] - era=0 epoch=2740 tstep=2741 dt=0.591 beta=4.000 loss=-13.669 dQsin=0.239 dQint=0.178 energy=400.852 logprob=397.768 logdet=3.084 sldf=1.679 sldb=-1.381 sld=3.084 xeps=0.132 veps=0.112 acc=0.586 sumlogdet=0.012 acc_mask=0.589 plaqs=0.864 intQ=0.052 sinQ=0.040 lr=0.001
[06/23/23 13:29:03][INFO][trainer.py:1722] - era=0 epoch=3000 tstep=3001 dt=0.825 beta=4.000 loss=-13.659 dQsin=0.229 dQint=0.175 energy=402.199 logprob=398.541 logdet=3.658 sldf=1.994 sldb=-1.676 sld=3.658 xeps=0.142 veps=0.118 acc=0.541 sumlogdet=0.008 acc_mask=0.545 plaqs=0.863 intQ=-0.034 sinQ=-0.035 lr=0.001
[06/23/23 13:31:36][INFO][trainer.py:1722] - era=0 epoch=3240 tstep=3241 dt=0.593 beta=4.000 loss=-14.593 dQsin=0.232 dQint=0.182 energy=403.727 logprob=399.641 logdet=4.087 sldf=2.232 sldb=-1.965 sld=4.087 xeps=0.151 veps=0.121 acc=0.489 sumlogdet=0.012 acc_mask=0.498 plaqs=0.863 intQ=-0.009 sinQ=-0.012 lr=0.001
[06/23/23 13:34:09][INFO][trainer.py:1722] - era=0 epoch=3500 tstep=3501 dt=0.600 beta=4.000 loss=-10.267 dQsin=0.202 dQint=0.161 energy=404.429 logprob=399.713 logdet=4.716 sldf=2.575 sldb=-2.237 sld=4.716 xeps=0.152 veps=0.130 acc=0.432 sumlogdet=0.010 acc_mask=0.451 plaqs=0.863 intQ=-0.003 sinQ=-0.003 lr=0.001
[06/23/23 13:36:44][INFO][trainer.py:1722] - era=0 epoch=3740 tstep=3741 dt=0.602 beta=4.000 loss=-16.740 dQsin=0.239 dQint=0.202 energy=404.274 logprob=399.215 logdet=5.059 sldf=2.765 sldb=-2.461 sld=5.059 xeps=0.163 veps=0.133 acc=0.503 sumlogdet=0.013 acc_mask=0.507 plaqs=0.863 intQ=-0.027 sinQ=-0.024 lr=0.001
[06/23/23 13:39:19][INFO][trainer.py:1722] - era=0 epoch=4000 tstep=4001 dt=0.602 beta=4.000 loss=-17.072 dQsin=0.242 dQint=0.215 energy=405.285 logprob=399.736 logdet=5.549 sldf=3.037 sldb=-2.781 sld=5.549 xeps=0.171 veps=0.135 acc=0.460 sumlogdet=0.012 acc_mask=0.464 plaqs=0.864 intQ=0.013 sinQ=0.013 lr=0.001
[06/23/23 13:41:53][INFO][trainer.py:1722] - era=0 epoch=4240 tstep=4241 dt=0.600 beta=4.000 loss=-18.798 dQsin=0.236 dQint=0.218 energy=406.449 logprob=400.293 logdet=6.156 sldf=3.370 sldb=-3.104 sld=6.156 xeps=0.179 veps=0.137 acc=0.455 sumlogdet=0.011 acc_mask=0.451 plaqs=0.864 intQ=0.009 sinQ=0.007 lr=0.001
[06/23/23 13:44:28][INFO][trainer.py:1722] - era=0 epoch=4500 tstep=4501 dt=0.598 beta=4.000 loss=-18.046 dQsin=0.242 dQint=0.215 energy=406.391 logprob=400.047 logdet=6.343 sldf=3.476 sldb=-3.278 sld=6.343 xeps=0.183 veps=0.144 acc=0.463 sumlogdet=0.011 acc_mask=0.465 plaqs=0.864 intQ=-0.019 sinQ=-0.016 lr=0.001
[06/23/23 13:47:02][INFO][trainer.py:1722] - era=0 epoch=4740 tstep=4741 dt=0.601 beta=4.000 loss=-16.357 dQsin=0.230 dQint=0.206 energy=407.460 logprob=400.501 logdet=6.958 sldf=3.815 sldb=-3.604 sld=6.958 xeps=0.188 veps=0.147 acc=0.423 sumlogdet=0.010 acc_mask=0.426 plaqs=0.864 intQ=0.023 sinQ=0.022 lr=0.001
[06/23/23 13:49:51][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 13:49:56][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 13:50:00][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 13:50:05][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sldf_ridgeplot.svg
[06/23/23 13:50:09][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sldb_ridgeplot.svg
[06/23/23 13:50:13][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sld_ridgeplot.svg
[06/23/23 13:50:56][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/data/train_data.h5
[06/23/23 13:51:06][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 13:51:06][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/7d13620e1484d2f1898e8d25111a349d44f96802.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6d2aa12fc7b895ecb01732b641ade55bcc144d8c.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5c8dc3c3b2377e2396c8c18af0129ebe00ab8dd0.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/47bdd16c94ddaa9ca790f6eb7e1bc0a81096884e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f72e2858d462bfaf254e034b005d239f82813cea.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6dffde926798bf77dd315335986b1bd1aa0a9b83.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3818ed5f707eabfa77a6b76e8c2286ada1343450.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/879e257bb220f8c3b99c413ca0295b415275f643.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/520ebc34968fcde90af80462a6bb1ffd8d2588bb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d6be679cfcd697997e1f1082953d8123cb6999fe.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/33a3458db0fe1d42b6f122ced0e855813c7814a4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/dab0c16a9b78f927033c0becca58c3a521e31376.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/455931aaba521ac6d52db2c33261a04fb28fa1bb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/ff73a5f10d599d16fd5cf28a854ba398154723bc.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/973b5df9ed2c65bedd46efb82d13cc0ec93cc3cf.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/bb29e5b9a51173d1f34d6e94376ec56c240e1159.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d2f31260408eaf4a2598503e370d078d7e7a2bd8.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f7c0b19ca9f753258b79155c82002648bc61bab7.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/58adb3a94e4096e2a6f1d5ea888be5938b29c956.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/173247eb828addcccb43b23a53ad1d06f66bcfce.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4381174dca0b056a196d0479c088d1f3efe16f33.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b8d1b4496ef1b742185adee3e0c9ca5e890a7e21.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/8ec437183a8e38088c60b61f6bf741b9bd8cc5e0.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9ce225aca61eaac1955cf0e563f5c060ba26abdd.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5a159246299e40b9ab7c6846766b663a536f0980.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4ef7cf6fa40d2838e86ade19885717c6aa3bedad.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b0fa9b818f965b4b8688f3dc68c18951a2e9bda3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/ecc940df6894f40e5d5c5bd9422e5144818a87ad.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6ebfd6dfef5b41747fe8e59ad912637f95601122.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/356d9006165de27ce7f34065a2cef218a99e935e.png" class="img-fluid"></p>
</div>
</div>
<div id="7eb78cb8-b3f6-40df-adb2-611fee120960" class="cell markdown" data-tags="[]">
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">Inference</h3>
</section>
</div>
<div id="3c061b59-bad4-4273-bc55-753e21d32768" class="cell markdown" data-tags="[]">
<section id="evaluation" class="level4">
<h4 class="anchored" data-anchor-id="evaluation">Evaluation</h4>
</section>
</div>
<div id="c41eb269-a230-4fb7-b5d3-03d7aa7d5a71" class="cell code" data-execution_count="11" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T18:52:36.700835Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T18:52:36.700439Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T19:02:12.771274Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T19:02:12.757752Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T18:52:36.700817Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'pytorch'</span>][<span class="st">'eval'</span>] <span class="op">=</span> ptExpU1.trainer.<span class="bu">eval</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    job_type<span class="op">=</span><span class="st">'eval'</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    nprint<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    nchains<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    eval_steps<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ptExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'eval'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 13:52:42][WARNING][trainer.py:435] - x.shape (original): torch.Size([4096, 2, 16, 16])
[06/23/23 13:52:42][WARNING][trainer.py:435] - x[:nchains].shape: torch.Size([128, 2, 16, 16])
[06/23/23 13:52:42][INFO][trainer.py:1051] - eps=None
beta=4.0
nlog=10
table=&lt;rich.table.Table object at 0x7f2722bfbdf0&gt;
nprint=500
eval_steps=2000
nleapfrog=None</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/90a5e478cf73243724cacc3e8e49941e608b669d.png" width="1108" height="389"></p>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 13:52:46][INFO][trainer.py:1181] - estep=0 dt=0.278 beta=4.000 loss=-26.568 dQsin=0.310 dQint=0.328 energy=412.448 logprob=405.216 logdet=7.232 sldf=3.974 sldb=-3.865 sld=7.232 xeps=0.193 veps=0.148 acc=0.484 sumlogdet=0.003 acc_mask=0.508 plaqs=0.863 intQ=-0.086 sinQ=-0.055
[06/23/23 13:54:55][INFO][trainer.py:1181] - estep=500 dt=0.226 beta=4.000 loss=-23.825 dQsin=0.266 dQint=0.227 energy=407.989 logprob=400.742 logdet=7.247 sldf=3.976 sldb=-3.845 sld=7.247 xeps=0.193 veps=0.148 acc=0.470 sumlogdet=0.029 acc_mask=0.492 plaqs=0.862 intQ=-0.164 sinQ=-0.105
[06/23/23 13:57:02][INFO][trainer.py:1181] - estep=1000 dt=0.228 beta=4.000 loss=-23.745 dQsin=0.270 dQint=0.250 energy=410.211 logprob=402.944 logdet=7.266 sldf=3.987 sldb=-3.842 sld=7.266 xeps=0.193 veps=0.148 acc=0.456 sumlogdet=0.011 acc_mask=0.461 plaqs=0.863 intQ=-0.023 sinQ=-0.042
[06/23/23 13:59:11][INFO][trainer.py:1181] - estep=1500 dt=0.230 beta=4.000 loss=-18.855 dQsin=0.285 dQint=0.227 energy=408.605 logprob=401.337 logdet=7.267 sldf=3.984 sldb=-3.841 sld=7.267 xeps=0.193 veps=0.148 acc=0.432 sumlogdet=0.019 acc_mask=0.508 plaqs=0.863 intQ=0.125 sinQ=0.103
[06/23/23 14:01:28][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 14:01:32][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 14:01:37][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 14:01:41][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sldf_ridgeplot.svg
[06/23/23 14:01:45][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sldb_ridgeplot.svg
[06/23/23 14:01:50][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/sld_ridgeplot.svg
[06/23/23 14:02:02][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/data/eval_data.h5
[06/23/23 14:02:03][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 14:02:03][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/349615b5ddb5e5ff8a029e71f5df2e43c2017b37.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/33f2b64af3c55b6b9f9092066f02745546f73cb9.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/2a3459f101399ff1b4201488400b52d37704a235.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f9dd1efd66879ada60cdb53b0881ae239818b33e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0594044ac9bb875a5426df5079d6c3eea6ef136a.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9022f65638f717c0249efdbea0e79eaa9e6dec8d.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6465bd8d15c17440b0d1703ccb04608af239abc1.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/dd7d32f6e94b451a3379c418bed27053f136ce52.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/c8c332ad8537df61decd874d99a89740789c4964.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5854b016458bf24e11058cfd291e8e70d740306f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/23f8f82d498a7ab954c98547e4aaf5e3eb471f3d.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/bfe4b8ad60ed009cae6fa52cf59abc0468f2fa45.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e98ffbd623e098bdd063ff21cc2a4269756acf0d.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/705678f3da4898a16b2c0a5c9175e33ceee096b2.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/cdc08dad12cd81ed898d6c4d5744cf8d3924ca47.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/50af5bebd91e6f13b411656b5a2fef53fc9c2801.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/261e89edabee51d835f9317fd7f74cf7fd15bc07.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6b9cd2adec04a0d085da3229630f2b0420209a0a.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/1cacfa4989426e636e46b6e54cbf03c0d888fae1.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/447a0ede73d9e67291687d7aec0b6dddfd3f90be.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5f339a79a57e20aeedff2fcc8da3a6c4a85dd2cb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5ad91366b1aac13a7258f416f90f209b77204957.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/ddf6bd4ca3cca67c71ab110625aa78f62834fe98.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/12d953f10f7af1b3892c6cf7e02268737ca56fe3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/52cda52294e5f86662078c99c02f21344bc5a963.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/8b03fc7278fe8f60c302a19dd4b64dddad137c24.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b36d5d81147c93f2e5d60af97f1c2419aeb3a1c2.png" class="img-fluid"></p>
</div>
</div>
<div id="9fbcbcc7-8a40-4a41-8ea4-13e7eeeff3cf" class="cell markdown" data-tags="[]">
<section id="hmc" class="level4">
<h4 class="anchored" data-anchor-id="hmc">HMC</h4>
</section>
</div>
<div id="15556dfe-06da-413d-be08-b439f4801482" class="cell code" data-execution_count="12" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T19:02:12.861098Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T19:02:12.860736Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T19:04:52.573175Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T19:04:52.572673Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T19:02:12.861080Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'pytorch'</span>][<span class="st">'hmc'</span>] <span class="op">=</span> ptExpU1.trainer.<span class="bu">eval</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    job_type<span class="op">=</span><span class="st">'hmc'</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    nprint<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    nchains<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    eval_steps<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ptExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'hmc'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:02:13][WARNING][trainer.py:435] - Step size `eps` not specified for HMC! Using default: 0.1000 for generic HMC
[06/23/23 14:02:13][WARNING][trainer.py:435] - x.shape (original): torch.Size([4096, 2, 16, 16])
[06/23/23 14:02:13][WARNING][trainer.py:435] - x[:nchains].shape: torch.Size([128, 2, 16, 16])
[06/23/23 14:02:13][INFO][trainer.py:1051] - eps=0.1
beta=4.0
nlog=10
table=&lt;rich.table.Table object at 0x7f266407a500&gt;
nprint=500
eval_steps=2000
nleapfrog=20</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/7e8b44441613e03b2963cbfaca8a46568844755e.png" width="1108" height="389"></p>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:02:17][INFO][trainer.py:1181] - hstep=0 dt=0.034 beta=4.000 loss=-11.965 dQsin=0.256 dQint=0.172 energy=395.464 logprob=395.464 logdet=0.000 acc=0.762 sumlogdet=0.000 acc_mask=0.734 plaqs=0.864 intQ=0.203 sinQ=0.148
[06/23/23 14:02:47][INFO][trainer.py:1181] - hstep=500 dt=0.035 beta=4.000 loss=-15.159 dQsin=0.263 dQint=0.156 energy=395.520 logprob=395.520 logdet=0.000 acc=0.771 sumlogdet=0.000 acc_mask=0.734 plaqs=0.864 intQ=-0.078 sinQ=-0.086
[06/23/23 14:03:20][INFO][trainer.py:1181] - hstep=1000 dt=0.035 beta=4.000 loss=-17.856 dQsin=0.307 dQint=0.156 energy=395.126 logprob=395.126 logdet=0.000 acc=0.832 sumlogdet=0.000 acc_mask=0.859 plaqs=0.864 intQ=0.125 sinQ=0.102
[06/23/23 14:03:52][INFO][trainer.py:1181] - hstep=1500 dt=0.035 beta=4.000 loss=-9.512 dQsin=0.242 dQint=0.055 energy=397.486 logprob=397.486 logdet=0.000 acc=0.791 sumlogdet=0.000 acc_mask=0.812 plaqs=0.863 intQ=-0.148 sinQ=-0.106
[06/23/23 14:04:26][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 14:04:32][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 14:04:36][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 14:04:46][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125815/pytorch/data/hmc_data.h5
[06/23/23 14:04:46][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 14:04:46][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/ed20286c82775bf39bbf5b6d51ca8aed7deb736e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/2de173f116270c978564829dcec299092897bd79.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5aeefbc762a4f55f21f4847c42e4a31adc52a95c.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e378a9f71a8044dac83c8c2f7f57f46fc2d52254.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/ae2220aaf83e485e7b450508f25af10d5650ecc9.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d2fa20eae1f19c33ef88639f4fd7ca657c75c61f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/04b0d0ce37ce4eb770c0f31bb43c9df1a577340f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f58571fb4a1e58c1ec63378a9e578c73646fa016.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4cf6c5cd19fed89dec70020e16e22d361d43f11b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3d919cc5f87d2d307efba66b1304407c4aacc7d4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/69ba6ea06ee4da50119de958550377145090542d.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/75b918c31f057695d67d13e206d968a68444a8c3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/fa2cc5f5cfd8700758aac1b5f9d2745f247385a1.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a1ba5f20c83182d7c1ccf1313f6e6661c6c0e273.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/50e26f31ca7bbef4e56f2e385336d8c689a2fdf3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a7394b061825bd6a3816ee1bcf83ee0ef85a528b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e0afbecac790d590f52a4c603705636126935532.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4788925eab3876108af362d0e8bc246b309db14b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3f7182f75ea7be3de466f0acdf28643b29cc5eb9.png" class="img-fluid"></p>
</div>
</div>
<div id="b4c38b52-13b3-43c0-8eda-e44a0abc0e3e" class="cell markdown" data-tags="[]">
<section id="tensorflow" class="level2">
<h2 class="anchored" data-anchor-id="tensorflow">TensorFlow</h2>
</section>
</div>
<div id="0ffa26c5-846d-4019-aa46-702f953acd10" class="cell markdown" data-tags="[]">
<section id="train" class="level3">
<h3 class="anchored" data-anchor-id="train">Train</h3>
</section>
</div>
<div id="995804d9-17e0-498a-9465-41ff80ca44cc" class="cell code" data-execution_count="13" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T19:04:52.742638Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T19:04:52.742508Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T19:31:22.805102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T19:31:22.804577Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T19:04:52.742620Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'tensorflow'</span>][<span class="st">'train'</span>] <span class="op">=</span> tfExpU1.trainer.train()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    nera=5,</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    nepoch=2000,</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    beta=[4.0, 4.25, 4.5, 4.75, 5.0],</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tfExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'train'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:05:07][INFO][trainer.py:200] - Looking for checkpoints in: /lus/grand/projects/DLHMC/foremans/locations/thetaGPU/projects/l2hmc-qcd/src/l2hmc/checkpoints/U1/2-16-16/nlf-10/xsplit-True/sepnets-True/merge-True/net-16-16-16_dp-0.2_bn-False/tensorflow
[06/23/23 14:05:07][INFO][trainer.py:200] - No checkpoints found to load from. Continuing</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/9fbb0ed154d423574fb6a62d67f630750261f07b.png" width="1108" height="389"></p>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:05:07][INFO][trainer.py:1266] - ERA: 0 / 1, BETA: 4.000
[06/23/23 14:06:32][INFO][trainer.py:200] - Thermalizing configs @ 4.00 took 85.1316 s</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb36"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">"model_id"</span><span class="fu">:</span><span class="st">"3ce8a6d5ef17444abb0644b54156bbcf"</span><span class="fu">,</span><span class="dt">"version_major"</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">"version_minor"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="output stream stdout">
<pre><code>WARNING:tensorflow:From /lus/grand/projects/datascience/foremans/locations/thetaGPU/miniconda3/envs/2023-04-26/lib/python3.10/site-packages/tensorflow/python/autograph/pyct/static_analysis/liveness.py:83: Analyzer.lamba_check (from tensorflow.python.autograph.pyct.static_analysis.liveness) is deprecated and will be removed after 2023-09-23.
Instructions for updating:
Lambda fuctions will be no more assumed to be used in the statement where they are used, or at least in the same block. https://github.com/tensorflow/tensorflow/issues/56089
[06/23/23 14:08:07][INFO][trainer.py:1089] - era=0 epoch=0 tstep=1.000 dt=93.926 beta=4.000 loss=97.795 dQsin=0.001 dQint=0.001 energy=1281.699 logprob=1281.654 logdet=0.046 sldf=0.060 sldb=0.094 sld=0.046 xeps=0.050 veps=0.050 acc=0.001 sumlogdet=-0.001 acc_mask=0.001 plaqs=0.021 intQ=-0.042 sinQ=0.020 lr=0.001
[06/23/23 14:09:11][INFO][trainer.py:1089] - era=0 epoch=240 tstep=241.000 dt=0.239 beta=4.000 loss=-0.984 dQsin=0.153 dQint=0.055 energy=395.706 logprob=396.037 logdet=-0.332 sldf=-0.175 sldb=0.045 sld=-0.332 xeps=0.048 veps=0.044 acc=0.550 sumlogdet=0.004 acc_mask=0.555 plaqs=0.864 intQ=0.010 sinQ=0.003 lr=0.001
[06/23/23 14:10:15][INFO][trainer.py:1089] - era=0 epoch=500 tstep=501.000 dt=0.241 beta=4.000 loss=-4.051 dQsin=0.190 dQint=0.064 energy=394.337 logprob=395.721 logdet=-1.383 sldf=-0.746 sldb=0.488 sld=-1.383 xeps=0.047 veps=0.043 acc=0.709 sumlogdet=-0.025 acc_mask=0.708 plaqs=0.864 intQ=-0.025 sinQ=-0.025 lr=0.001
[06/23/23 14:11:22][INFO][trainer.py:1089] - era=0 epoch=740 tstep=741.000 dt=0.236 beta=4.000 loss=-6.052 dQsin=0.206 dQint=0.072 energy=394.177 logprob=395.854 logdet=-1.677 sldf=-0.908 sldb=0.629 sld=-1.677 xeps=0.048 veps=0.043 acc=0.759 sumlogdet=-0.001 acc_mask=0.754 plaqs=0.864 intQ=0.006 sinQ=0.003 lr=0.001
[06/23/23 14:12:27][INFO][trainer.py:1089] - era=0 epoch=1000 tstep=1001.000 dt=0.244 beta=4.000 loss=-6.203 dQsin=0.221 dQint=0.075 energy=394.858 logprob=396.599 logdet=-1.742 sldf=-0.942 sldb=0.653 sld=-1.742 xeps=0.049 veps=0.045 acc=0.811 sumlogdet=-0.011 acc_mask=0.812 plaqs=0.863 intQ=0.029 sinQ=0.026 lr=0.001
[06/23/23 14:13:32][INFO][trainer.py:1089] - era=0 epoch=1240 tstep=1241.000 dt=0.234 beta=4.000 loss=-7.401 dQsin=0.235 dQint=0.084 energy=394.913 logprob=396.405 logdet=-1.493 sldf=-0.809 sldb=0.544 sld=-1.493 xeps=0.050 veps=0.046 acc=0.833 sumlogdet=0.004 acc_mask=0.831 plaqs=0.863 intQ=0.023 sinQ=0.021 lr=0.001
[06/23/23 14:14:40][INFO][trainer.py:1089] - era=0 epoch=1500 tstep=1501.000 dt=0.241 beta=4.000 loss=-7.387 dQsin=0.239 dQint=0.089 energy=394.786 logprob=395.871 logdet=-1.084 sldf=-0.586 sldb=0.393 sld=-1.084 xeps=0.051 veps=0.047 acc=0.854 sumlogdet=-0.001 acc_mask=0.854 plaqs=0.864 intQ=-0.008 sinQ=-0.012 lr=0.001
[06/23/23 14:15:46][INFO][trainer.py:1089] - era=0 epoch=1740 tstep=1741.000 dt=0.276 beta=4.000 loss=-8.684 dQsin=0.250 dQint=0.086 energy=394.998 logprob=395.804 logdet=-0.806 sldf=-0.438 sldb=0.318 sld=-0.806 xeps=0.053 veps=0.049 acc=0.878 sumlogdet=0.001 acc_mask=0.873 plaqs=0.864 intQ=0.036 sinQ=0.023 lr=0.001
[06/23/23 14:16:52][INFO][trainer.py:1089] - era=0 epoch=2000 tstep=2001.000 dt=0.280 beta=4.000 loss=-8.376 dQsin=0.255 dQint=0.095 energy=394.788 logprob=395.364 logdet=-0.576 sldf=-0.314 sldb=0.244 sld=-0.576 xeps=0.054 veps=0.050 acc=0.896 sumlogdet=0.002 acc_mask=0.897 plaqs=0.863 intQ=-0.023 sinQ=-0.021 lr=0.001
[06/23/23 14:17:56][INFO][trainer.py:1089] - era=0 epoch=2240 tstep=2241.000 dt=0.238 beta=4.000 loss=-9.100 dQsin=0.258 dQint=0.106 energy=395.875 logprob=396.324 logdet=-0.449 sldf=-0.245 sldb=0.219 sld=-0.449 xeps=0.059 veps=0.054 acc=0.904 sumlogdet=-0.002 acc_mask=0.902 plaqs=0.863 intQ=0.029 sinQ=0.027 lr=0.001
[06/23/23 14:19:00][INFO][trainer.py:1089] - era=0 epoch=2500 tstep=2501.000 dt=0.244 beta=4.000 loss=-9.489 dQsin=0.247 dQint=0.103 energy=395.602 logprob=395.899 logdet=-0.297 sldf=-0.165 sldb=0.195 sld=-0.297 xeps=0.064 veps=0.058 acc=0.876 sumlogdet=0.001 acc_mask=0.864 plaqs=0.864 intQ=0.028 sinQ=0.024 lr=0.001
[06/23/23 14:20:04][INFO][trainer.py:1089] - era=0 epoch=2740 tstep=2741.000 dt=0.251 beta=4.000 loss=-9.468 dQsin=0.250 dQint=0.107 energy=395.899 logprob=396.116 logdet=-0.217 sldf=-0.122 sldb=0.183 sld=-0.217 xeps=0.072 veps=0.065 acc=0.857 sumlogdet=0.001 acc_mask=0.854 plaqs=0.863 intQ=-0.045 sinQ=-0.034 lr=0.001
[06/23/23 14:21:08][INFO][trainer.py:1089] - era=0 epoch=3000 tstep=3001.000 dt=0.236 beta=4.000 loss=-10.554 dQsin=0.248 dQint=0.132 energy=395.727 logprob=395.661 logdet=0.065 sldf=0.030 sldb=0.088 sld=0.065 xeps=0.084 veps=0.071 acc=0.782 sumlogdet=0.002 acc_mask=0.781 plaqs=0.864 intQ=0.024 sinQ=0.015 lr=0.001
[06/23/23 14:22:12][INFO][trainer.py:1089] - era=0 epoch=3240 tstep=3241.000 dt=0.253 beta=4.000 loss=-10.425 dQsin=0.252 dQint=0.141 energy=396.195 logprob=396.024 logdet=0.171 sldf=0.086 sldb=0.076 sld=0.171 xeps=0.094 veps=0.080 acc=0.790 sumlogdet=0.002 acc_mask=0.795 plaqs=0.864 intQ=-0.002 sinQ=-0.000 lr=0.001
[06/23/23 14:23:17][INFO][trainer.py:1089] - era=0 epoch=3500 tstep=3501.000 dt=0.271 beta=4.000 loss=-13.095 dQsin=0.254 dQint=0.161 energy=396.836 logprob=396.210 logdet=0.627 sldf=0.335 sldb=-0.134 sld=0.627 xeps=0.109 veps=0.089 acc=0.709 sumlogdet=0.002 acc_mask=0.708 plaqs=0.864 intQ=0.045 sinQ=0.043 lr=0.001
[06/23/23 14:24:22][INFO][trainer.py:1089] - era=0 epoch=3740 tstep=3741.000 dt=0.242 beta=4.000 loss=-13.164 dQsin=0.226 dQint=0.160 energy=399.160 logprob=397.731 logdet=1.429 sldf=0.772 sldb=-0.496 sld=1.429 xeps=0.123 veps=0.093 acc=0.585 sumlogdet=-0.003 acc_mask=0.574 plaqs=0.864 intQ=0.002 sinQ=-0.000 lr=0.001
[06/23/23 14:25:27][INFO][trainer.py:1089] - era=0 epoch=4000 tstep=4001.000 dt=0.254 beta=4.000 loss=-15.590 dQsin=0.251 dQint=0.197 energy=399.077 logprob=397.221 logdet=1.856 sldf=1.005 sldb=-0.672 sld=1.856 xeps=0.138 veps=0.104 acc=0.600 sumlogdet=-0.006 acc_mask=0.601 plaqs=0.863 intQ=-0.021 sinQ=-0.013 lr=0.001
[06/23/23 14:26:31][INFO][trainer.py:1089] - era=0 epoch=4240 tstep=4241.000 dt=0.244 beta=4.000 loss=-14.301 dQsin=0.232 dQint=0.177 energy=401.006 logprob=398.483 logdet=2.523 sldf=1.369 sldb=-1.005 sld=2.523 xeps=0.150 veps=0.109 acc=0.538 sumlogdet=0.006 acc_mask=0.539 plaqs=0.864 intQ=0.018 sinQ=0.008 lr=0.001
[06/23/23 14:27:38][INFO][trainer.py:1089] - era=0 epoch=4500 tstep=4501.000 dt=0.245 beta=4.000 loss=-14.125 dQsin=0.209 dQint=0.183 energy=403.764 logprob=400.618 logdet=3.145 sldf=1.714 sldb=-1.357 sld=3.145 xeps=0.166 veps=0.109 acc=0.411 sumlogdet=-0.002 acc_mask=0.407 plaqs=0.863 intQ=0.014 sinQ=0.017 lr=0.001
[06/23/23 14:28:43][INFO][trainer.py:1089] - era=0 epoch=4740 tstep=4741.000 dt=0.241 beta=4.000 loss=-21.004 dQsin=0.266 dQint=0.235 energy=402.266 logprob=399.061 logdet=3.205 sldf=1.750 sldb=-1.493 sld=3.205 xeps=0.172 veps=0.121 acc=0.536 sumlogdet=0.002 acc_mask=0.539 plaqs=0.863 intQ=-0.024 sinQ=-0.016 lr=0.001
[06/23/23 14:29:47][INFO][trainer.py:1303] - Saving took: 3.12328e-05s
[06/23/23 14:29:47][INFO][trainer.py:1304] - Checkpoint saved to: /lus/grand/projects/DLHMC/foremans/locations/thetaGPU/projects/l2hmc-qcd/src/l2hmc/checkpoints/U1/2-16-16/nlf-10/xsplit-True/sepnets-True/merge-True/net-16-16-16_dp-0.2_bn-False/tensorflow
[06/23/23 14:29:47][INFO][trainer.py:1305] - Era 0 took: 1480.06s
[06/23/23 14:29:52][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 14:29:58][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 14:30:03][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 14:30:08][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sldf_ridgeplot.svg
[06/23/23 14:30:13][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sldb_ridgeplot.svg
[06/23/23 14:30:18][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sld_ridgeplot.svg
[06/23/23 14:31:02][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/data/train_data.h5
[06/23/23 14:31:12][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 14:31:12][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/bc8f012cff0f12bfd7d8f5899f467f0b04d1c9f4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/7ad1f183ce7436cab3ac2a6611eada039cc28c23.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9d4b10b3eb0ca80844ac23087396a1348571d25e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0ab053c480477da8d0fe3714a2aeccd84b3def15.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/eca0a15cbc2c851d7aad0d1e3760dc89cb0d8ada.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/11da03e7fa757048470bc4324e34f6afe325094f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e1bcd0aa338e4dbc799e588953809e2d2f4bb623.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/62abf81772f30cb0131a2a2fe8639bc34e4a6d91.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d06241e30606b123859a49a5c5d91369298248e2.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/71caddac0e1a8ec91b72abf171d3f7bc661591ca.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/2df25c501810b19f20596b34bf9eda3246724d89.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/c8b70caf1ee5a1b2f43eadb345156f84bceb3a76.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b744ef91e73c64010a04f8ae08b0bbc06f0f7ab2.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e012a974574a1f3ffabc5405d57a27eb5684f1ad.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/53450e9812f7375171c36c338fd2511ac3fe9553.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/343c2c596d60fe524108f1eebbda7ff288f98847.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f6d1a5278ac4609a95ad18ea79dd43f1ba9e5678.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5ea88e0e246b0df8cdfc69aa0010fdaa57b6dd11.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/bdb9adda3dfcf48486b2c7e63031b59749239b5e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f50cdbefe24ae29c9cc3687b7c6a28f897c06589.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5cb5dba81ec50f2ffd14c1ab096c71926f7e53fb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5276d608591daa1b750e3e8ba33adc8b7f4ce587.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/367ad91a96bf3459fd83a96b7978463360fdedbb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d896447ac95eb1f0e7159ee97a92633d0b5565de.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/52cca62e99a6552a083368137f01273a262c38c7.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/48eb82fab0136487bb9e76e9673026c80ad4ee07.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a5bab36c412414e9a217ce48bcccd9183305a1c4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3afef3b0f769ff75a1af190c73d15f89d603d3b4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d622a4277f2d0d232b363206d908c3f8704d298b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5313ad2537c31d30cceecb44308d8b76a70c456c.png" class="img-fluid"></p>
</div>
</div>
<div id="ea6a6d0b-2fba-4abd-a7d8-0598983b5c40" class="cell markdown" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-02-18T23:44:58.472034Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-02-18T23:44:58.471642Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-02-18T23:44:58.504838Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-02-18T23:44:58.504300Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-02-18T23:44:58.472018Z&quot;}" data-tags="[]">
<section id="inference-1" class="level3">
<h3 class="anchored" data-anchor-id="inference-1">Inference</h3>
</section>
</div>
<div id="e45ffd0d-3f8c-4b22-b9fe-378de21a4703" class="cell markdown">
<section id="evaluate" class="level4">
<h4 class="anchored" data-anchor-id="evaluate">Evaluate</h4>
</section>
</div>
<div id="5b0b3e81-c3cb-4042-88e3-7048d48aef1d" class="cell code" data-execution_count="14" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T19:31:22.812150Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T19:31:22.812028Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T19:36:40.325620Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T19:36:40.325083Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T19:31:22.812134Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'tensorflow'</span>][<span class="st">'eval'</span>] <span class="op">=</span> tfExpU1.trainer.<span class="bu">eval</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    job_type<span class="op">=</span><span class="st">'eval'</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    nprint<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    nchains<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    eval_steps<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tfExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'eval'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:31:23][WARNING][trainer.py:196] - x.shape (original): (4096, 2, 16, 16)
[06/23/23 14:31:23][WARNING][trainer.py:196] - x[:nchains].shape: (128, 2, 16, 16)
[06/23/23 14:31:23][INFO][trainer.py:200] - eps = None
beta = 4.0
nlog = 10
table = &lt;rich.table.Table object at 0x7f26042c9e70&gt;
nprint = 500
eval_steps = 2000
nleapfrog = None</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/eb44c97aabe9785f673264745fefb2b83ea99d23.png" width="1108" height="389"></p>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb40"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">"model_id"</span><span class="fu">:</span><span class="st">"42d6b6d371eb4dbca473bb047e79f408"</span><span class="fu">,</span><span class="dt">"version_major"</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">"version_minor"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:33:00][INFO][trainer.py:200] - estep=0 dt=13.921 beta=4.000 loss=-34.934 dQsin=0.296 dQint=0.242 energy=402.696 logprob=398.796 logdet=3.900 sldf=2.138 sldb=-1.896 sld=3.900 xeps=0.183 veps=0.124 acc=0.472 sumlogdet=0.008 acc_mask=0.469 plaqs=0.865 intQ=0.094 sinQ=0.060
[06/23/23 14:33:49][INFO][trainer.py:200] - estep=500 dt=0.049 beta=4.000 loss=-14.736 dQsin=0.258 dQint=0.203 energy=404.299 logprob=400.366 logdet=3.932 sldf=2.151 sldb=-1.896 sld=3.932 xeps=0.183 veps=0.124 acc=0.456 sumlogdet=-0.009 acc_mask=0.500 plaqs=0.862 intQ=-0.211 sinQ=-0.169
[06/23/23 14:34:27][INFO][trainer.py:200] - estep=1000 dt=0.048 beta=4.000 loss=-14.039 dQsin=0.233 dQint=0.211 energy=403.103 logprob=399.185 logdet=3.917 sldf=2.142 sldb=-1.890 sld=3.917 xeps=0.183 veps=0.124 acc=0.477 sumlogdet=0.034 acc_mask=0.477 plaqs=0.864 intQ=0.070 sinQ=0.055
[06/23/23 14:35:05][INFO][trainer.py:200] - estep=1500 dt=0.048 beta=4.000 loss=-19.743 dQsin=0.225 dQint=0.203 energy=402.832 logprob=398.931 logdet=3.901 sldf=2.136 sldb=-1.895 sld=3.901 xeps=0.183 veps=0.124 acc=0.437 sumlogdet=-0.012 acc_mask=0.453 plaqs=0.864 intQ=-0.016 sinQ=-0.026
[06/23/23 14:35:49][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 14:35:54][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 14:35:59][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 14:36:04][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sldf_ridgeplot.svg
[06/23/23 14:36:09][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sldb_ridgeplot.svg
[06/23/23 14:36:14][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/sld_ridgeplot.svg
[06/23/23 14:36:29][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/data/eval_data.h5
[06/23/23 14:36:29][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 14:36:29][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/b34cb40e78e35b06a7593481dab495869664b379.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/02a46ab7fdd4996eec3315f0bbf1443c7d0c44b5.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a6e5f19a3fd364853c1428cb595af7951ad68998.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/6e189b8a97a84ab054e41b320e8b6e34a431f713.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b5c32046606157b939e5c34e81c32c27885c6c2c.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/7c22e0f0f180e644878e41ca793bc14eb34f6ae4.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/dcf603dac9c9d094f16bf216bb9d3541749acf56.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/7b7de727f64a0c5a274c9f8bbe6d03aaf5d2f68e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/1e9f5eaf48ab0d3f1854b1645eba17a2fb37376f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/fd3436d9b7f82f9dfcbb74f8eff1b3db173af32f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f58375f8a5747ab00774e67986fa5b28db8f1125.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e6ec67288d5adef4a5ff12baa5dbd7ef9fdd78b7.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/27d8001582ca479aff7c8e383a858441e020be2b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0fe6a5bf3df03de872d305840bea9980b32bd867.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b1aae6f98c4213e31c87a0e82ca9bb3886e77fef.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/215a689fb131b01b78ea968dc8e4849d60c532aa.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a5426cd21f03946e84ed0217c84ad910c540a5bf.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/47d40865a6ab9e11a4c0f744219d3e8e18430e53.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/c4ea763aa4bc11ceaf4d8af03897cb46b2874e4f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/c7e9ffc19083168291b97fabd31fcbbfa121fafb.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9233293e2e538ef4ba34d367e7993a67f504a3d1.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f55c522bb055375b6d63b84060492a39ef970a31.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9529e6bb6e32f18cd85f38d20d878bdcbd2ea59f.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/7dc939b9dbc32ea0bb6d34a7d8d6a98243035c14.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0e2dc91ff1eec7c36858ebad410b960839fa7742.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/50d98797994fec9b2f5e78e15b23812b00e2fad1.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3fc77584f96fb4750d723fdc600147b0608a95dc.png" class="img-fluid"></p>
</div>
</div>
<div id="c32cae38-3491-401c-870d-ae3c7716d214" class="cell markdown">
<section id="hmc-1" class="level4">
<h4 class="anchored" data-anchor-id="hmc-1">HMC</h4>
</section>
</div>
<div id="6ef96676-dfad-4031-96f8-2ba0cbcc4888" class="cell code" data-execution_count="15" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T19:36:40.326972Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T19:36:40.326685Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T19:46:08.444425Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T19:46:08.443653Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T19:36:40.326954Z&quot;}" data-scrolled="true" data-tags="[]">
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>outputs[<span class="st">'tensorflow'</span>][<span class="st">'hmc'</span>] <span class="op">=</span> tfExpU1.trainer.<span class="bu">eval</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    job_type<span class="op">=</span><span class="st">'hmc'</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    nprint<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    nchains<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    eval_steps<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tfExpU1.save_dataset(job_type<span class="op">=</span><span class="st">'hmc'</span>, nchains<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:36:40][WARNING][trainer.py:196] - Step size `eps` not specified for HMC! Using default: 0.1000 for generic HMC
[06/23/23 14:36:40][WARNING][trainer.py:196] - x.shape (original): (4096, 2, 16, 16)
[06/23/23 14:36:40][WARNING][trainer.py:196] - x[:nchains].shape: (128, 2, 16, 16)
[06/23/23 14:36:40][INFO][trainer.py:200] - eps = 0.1
beta = 4.0
nlog = 10
table = &lt;rich.table.Table object at 0x7f17f07da080&gt;
nprint = 500
eval_steps = 2000
nleapfrog = 20</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/f34f47c948373d280dfd39c87e3215635e3e4eec.png" width="1119" height="394"></p>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb44"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">"model_id"</span><span class="fu">:</span><span class="st">"c9e14ead5fda4789a4a40038a941d064"</span><span class="fu">,</span><span class="dt">"version_major"</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">"version_minor"</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="output stream stdout">
<pre><code>[06/23/23 14:38:03][INFO][trainer.py:200] - hstep=0 dt=0.197 beta=4.000 loss=-14.990 dQsin=0.288 dQint=0.195 energy=397.008 logprob=397.008 logdet=0.000 acc=0.822 sumlogdet=0.000 acc_mask=0.828 plaqs=0.862 intQ=-0.148 sinQ=-0.153
[06/23/23 14:39:55][INFO][trainer.py:200] - hstep=500 dt=0.193 beta=4.000 loss=-11.040 dQsin=0.261 dQint=0.141 energy=396.582 logprob=396.582 logdet=0.000 acc=0.815 sumlogdet=0.000 acc_mask=0.781 plaqs=0.862 intQ=0.055 sinQ=0.060
[06/23/23 14:41:47][INFO][trainer.py:200] - hstep=1000 dt=0.193 beta=4.000 loss=-14.025 dQsin=0.287 dQint=0.180 energy=395.838 logprob=395.838 logdet=0.000 acc=0.818 sumlogdet=0.000 acc_mask=0.836 plaqs=0.863 intQ=-0.117 sinQ=-0.090
[06/23/23 14:43:39][INFO][trainer.py:200] - hstep=1500 dt=0.193 beta=4.000 loss=-18.793 dQsin=0.300 dQint=0.195 energy=393.051 logprob=393.051 logdet=0.000 acc=0.813 sumlogdet=0.000 acc_mask=0.844 plaqs=0.862 intQ=0.047 sinQ=0.039
[06/23/23 14:45:36][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/energy_ridgeplot.svg
[06/23/23 14:45:45][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logprob_ridgeplot.svg
[06/23/23 14:45:49][INFO][plot_helpers.py:1005] - Saving figure to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/plots/ridgeplots/svgs/logdet_ridgeplot.svg
[06/23/23 14:46:01][INFO][common.py:271] - Saving dataset to: /lus/grand/projects/datascience/foremans/locations/thetaGPU/projects/saforem2/l2hmc-qcd/src/l2hmc/notebooks/outputs/2023-06-23-125818/tensorflow/data/hmc_data.h5
[06/23/23 14:46:01][INFO][experiment.py:362] - Done saving and analyzing data.
[06/23/23 14:46:01][INFO][experiment.py:363] - Creating summaries for WandB, Aim</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/048eaea06cecc8a1caf789f6ef438cd0fd54de90.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0c89542c4e47bcd5ecc5770944e762ce1c3b9531.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e6db427847c3766ebc031dd0c98c533d01d62b7d.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e378a9f71a8044dac83c8c2f7f57f46fc2d52254.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/b1c92efc2f33a4926975d7d7c6413a68af5cef83.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/e74e4993b7dbb3a3206740f3bdc7e3b931010f52.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/279f14d6c4674c03edc4905ca602cd2ffd62a684.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/a0d4516379bc594a77d54597601bd817bfd356c3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/5fc884deeaa43bdae5618c9f20c4b2d43505ebaa.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/0b6cf0917f4941608c2303c69f5bd14f30329d6e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/3bc94896c65ea508518f45cb438c6a572528e9a3.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/9b3692bf99881b38ea6bf6576b1a9b7cd13b78c0.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/fe2d0db8bee3f1451419ce473f946de573c7c083.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/49177866b3d4c9b60ba4e534b9c0fdc167c34b1c.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/ec7e16ae09ccda8091c929a4cf62bc6e60d23be7.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/f5bf7968df2fd278eba8b561ab2099adc3a38bf5.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/d573b183c1cd5175ad8761d80a7a65318fbbec15.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/bd455cd613e99292ac2a98ce3d9d9260a3006a5b.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/719525e3a567f563b3b62bcb591cfb980187c850.png" class="img-fluid"></p>
</div>
</div>
<div id="7362bae6-b284-4b71-b17a-014bd5c682cb" class="cell markdown" data-tags="[]">
<section id="model-performance" class="level1">
<h1>Model Performance</h1>
<p>Our goal is improving the efficiency of our MCMC sampler.</p>
<p>In particular, we are interested in generating <strong>independent</strong> save_datasetrations which we can then use to calculate expectation values of physical observables.</p>
<p>For our purposes, we are interested in obtaining lattice configurations from distinct <em>topological charge sectors</em>, as characterized by a configurations <em>topological charge</em>, <span class="math inline">Q</span>.</p>
<p>HMC is known to suffer from <em>critical slowing down</em>, a phenomenon in which our configurations remains stuck in some local topological charge sector and fails to produce distinct configurations.</p>
<p>In particular, it is known that the integrated autocorrelation time of the topological charge <span class="math inline">\tau</span> grows exponentially with decreasing lattice spacing (i.e.&nbsp;continuum limit), making this theory especially problematic.</p>
<p>Because of this, we can assess our models’ performance by looking at the <em>tunneling rate</em>, i.e.&nbsp;the rate at which our sampler jumps between these different charge sectors.</p>
<p>We can write this quantity as:</p>
<p><span class="math display">
\delta Q = |Q^{(i)} - Q^{(i-1)}|
</span></p>
<p>where we look at the difference in the topological charge between sequential configurations.</p>
<div class="alert alert-block alert-info" style="background:rgba(34,139,230,0.1); color: rgb(34,139,230); border: 0px solid; border-radius:5px;">
<p><b>Note:</b> The efficiency of our sampler is directly proportional to the tunneling rate, which is inversely proportional to the integrated autocorrelation time <span class="math inline">\tau</span>, i.e.
&nbsp;
<span class="math display">
\text{Efficiency} \propto \delta Q \propto \frac{1}{\tau}
</span>
Explicitly, this means that the <strong>more efficient</strong> the model <span class="math inline">\longrightarrow</span>
- the <strong>larger</strong> tunneling rate - the <strong>smaller</strong> integrated autocorrelation time for <span class="math inline">Q</span></p>
</div>
</section>
</div>
<div id="85deb4b7-dba9-42f0-b41b-afafc0d74020" class="cell code" data-execution_count="16" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:34:56.244038Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:34:56.231121Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:34:57.040167Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:34:57.039703Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:34:56.244015Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_thermalized_configs(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        x: np.ndarray <span class="op">|</span> xr.DataArray,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        drop: <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray <span class="op">|</span> xr.DataArray:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Drop the first `drop` states across all chains.</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">    x.shape = [draws, chains]</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(x, np.ndarray):</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.sort(x)[..., :<span class="op">-</span>drop]</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(x, xr.DataArray):</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x.sortby(</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>            [<span class="st">'chain'</span>, <span class="st">'draw'</span>],</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            ascending<span class="op">=</span><span class="va">False</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        )[..., :<span class="op">-</span>drop]</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="debf78d3-a425-4290-9e34-8d6b836010fa" class="cell markdown" data-tags="[]">
<section id="comparisons" class="level1">
<h1>Comparisons</h1>
<p>We can measure our models’ performance explicitly by looking at the average tunneling rate, <span class="math inline">\delta Q_{\mathbb{Z}}</span>, for our <strong>trained model</strong> and comparing it against generic HMC.</p>
<p>Recall,</p>
<p><span class="math display">\delta Q_{\mathbb{Z}} := \big|Q^{(i+1)}_{\mathbb{Z}} - Q^{(i)}_{\mathbb{Z}}\big|</span></p>
<p>where a <strong>higher</strong> value of <span class="math inline">\delta Q_{\mathbb{Z}}</span> corresponds to <strong>better</strong> tunneling of the topological charge, <span class="math inline">Q_{\mathbb{Z}}</span>.</p>
<p>Note that we can get a concise representation of the data from different parts of our run via:</p>
<p>Note that the data from each of the different parts of our experiment (i.e.&nbsp;<code>train</code>, <code>eval</code>, and <code>hmc</code>) are stored as a dict, e.g.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">list</span>(ptExpU1.trainer.histories.keys())</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'train'</span>, <span class="st">'eval'</span>, <span class="st">'hmc'</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> train_history <span class="op">=</span> ptExpU1.trainer.histories[<span class="st">'train'</span>]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> train_dset <span class="op">=</span> train_history.get_dataset()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="cf">assert</span> <span class="bu">isinstance</span>(train_history, l2hmc.utils.history.BaseHistory)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="cf">assert</span> <span class="bu">isinstance</span>(train_dset, xarray.Dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(see below, for example)</p>
</section>
</div>
<div id="3060f955-5141-4a20-a126-a469b515f68e" class="cell markdown" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-02-08T01:04:54.415764Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-02-08T01:04:54.415447Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-02-08T01:04:54.621162Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-02-08T01:04:54.620371Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-02-08T01:04:54.415746Z&quot;}">
<p>We aggregate the data into the <code>dsets</code> dict below, grouped by:</p>
<ol type="1">
<li><strong>Framework</strong> (<code>pytorch</code> / <code>tensorflow</code>)</li>
<li><strong>Job type</strong> (<code>train</code>, <code>eval</code>, <code>hmc</code>)</li>
</ol>
</div>
<div id="0af76ad8-26ad-4b4e-89c1-3e0eaf6bbb36" class="cell code" data-execution_count="21" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:35:54.373083Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:35:54.372676Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:35:54.825550Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:35:54.825010Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:35:54.373066Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>log <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>dsets <span class="op">=</span> {}</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>fws <span class="op">=</span> [<span class="st">'pt'</span>, <span class="st">'tf'</span>]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>modes <span class="op">=</span> [<span class="st">'train'</span>, <span class="st">'eval'</span>, <span class="st">'hmc'</span>]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fw <span class="kw">in</span> fws:</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    dsets[fw] <span class="op">=</span> {}</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mode <span class="kw">in</span> modes:</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        hist <span class="op">=</span> <span class="va">None</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fw <span class="op">==</span> <span class="st">'pt'</span>:</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>            hist <span class="op">=</span> ptExpU1.trainer.histories.get(mode, <span class="va">None</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> fw <span class="op">==</span> <span class="st">'tf'</span>:</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>            hist <span class="op">=</span> tfExpU1.trainer.histories.get(mode, <span class="va">None</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hist <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>            console.<span class="bu">print</span>(<span class="ss">f'Getting dataset for </span><span class="sc">{</span>fw<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mode<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>            dsets[fw][mode] <span class="op">=</span> hist.get_dataset()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>Getting dataset for pt: train
Getting dataset for pt: eval
Getting dataset for pt: hmc
Getting dataset for tf: train
Getting dataset for tf: eval
Getting dataset for tf: hmc</code></pre>
</div>
</div>
<div id="55042c3d-2305-426e-af6d-9b8a2ad8fe5b" class="cell code" data-execution_count="22" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:35:58.578527Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:35:58.578168Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:35:59.069135Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:35:59.068694Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:35:58.578511Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'text.usetex'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.utils.plot_helpers <span class="im">import</span> COLORS, set_plot_style</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>set_plot_style()</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">3</span>), ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- DROP FIRST 20% FOR THERMALIZATION ------</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>KEEP <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.8</span> <span class="op">*</span> <span class="bu">len</span>(dsets[<span class="st">'tf'</span>][<span class="st">'eval'</span>].draw))</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>dqpte <span class="op">=</span> get_thermalized_configs(dsets[<span class="st">'pt'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>dqpth <span class="op">=</span> get_thermalized_configs(dsets[<span class="st">'pt'</span>][<span class="st">'hmc'</span>][<span class="st">'dQint'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>dqtfe <span class="op">=</span> get_thermalized_configs(dsets[<span class="st">'tf'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>dqtfh <span class="op">=</span> get_thermalized_configs(dsets[<span class="st">'tf'</span>][<span class="st">'hmc'</span>][<span class="st">'dQint'</span>].astype(<span class="st">'int'</span>))</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.distplot(</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    dqpte.<span class="bu">sum</span>(<span class="st">'chain'</span>),</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>COLORS[<span class="st">'blue'</span>],</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Eval'</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">0</span>]</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.distplot(</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    dqpth.<span class="bu">sum</span>(<span class="st">'chain'</span>),</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>COLORS[<span class="st">'red'</span>],</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'HMC'</span>,</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">0</span>]</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">0</span>].set_title(<span class="st">'PyTorch'</span>)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">0</span>].set_xlabel(</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f'# tunneling events / </span><span class="sc">{</span>dqpte<span class="sc">.</span>shape[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> configurations'</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">'best'</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.distplot(</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>    dqtfe.<span class="bu">sum</span>(<span class="st">'chain'</span>),</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>COLORS[<span class="st">'blue'</span>],</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Eval'</span>,</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">1</span>]</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> sns.distplot(</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>    dqtfh.<span class="bu">sum</span>(<span class="st">'chain'</span>),</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>COLORS[<span class="st">'red'</span>],</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'HMC'</span>,</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">1</span>]</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">1</span>].set_title(<span class="st">'TensorFlow'</span>)</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">1</span>].set_xlabel(</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r"""$\sum_{i=0} \left|\delta Q_{i}\right|$""",</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fontsize='large',</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f'# tunneling events / </span><span class="sc">{</span>dqpte<span class="sc">.</span>shape[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss"> configurations'</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'best'</span>, frameon<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output display_data">
<p><img src="assets/6829327d1639d0833e5ebb1d0deea1712171cc25.png" class="img-fluid"></p>
</div>
</div>
<div id="526b81a3-9cfd-4583-910e-5e4d3a2a2efa" class="cell markdown">
<section id="tensorflow-results" class="level2">
<h2 class="anchored" data-anchor-id="tensorflow-results">TensorFlow Results</h2>
</section>
</div>
<div id="3e56f6ad-393d-4d5d-82d7-ea8829b5bf66" class="cell code" data-execution_count="23" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:36:04.351646Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:36:04.351281Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:36:04.482539Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:36:04.482121Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:36:04.351630Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rich</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6dd2f08d-1cd1-4942-ab22-0f903593bd10" class="cell code" data-execution_count="24" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:36:05.721407Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:36:05.721100Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:36:06.270051Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:36:06.269602Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:36:05.721390Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'notebook'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ndraws <span class="op">=</span> <span class="bu">len</span>(dsets[<span class="st">'tf'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>].draw)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>drop <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.1</span> <span class="op">*</span> ndraws)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.9</span> <span class="op">*</span> ndraws)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>dqe <span class="op">=</span> dsets[<span class="st">'tf'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>][:, <span class="op">-</span><span class="dv">90</span>:]</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>dqh <span class="op">=</span> dsets[<span class="st">'tf'</span>][<span class="st">'hmc'</span>][<span class="st">'dQint'</span>][:, <span class="op">-</span><span class="dv">90</span>:]</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>etot <span class="op">=</span> dqe.astype(<span class="bu">int</span>).<span class="bu">sum</span>()</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>htot <span class="op">=</span> dqh.astype(<span class="bu">int</span>).<span class="bu">sum</span>()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>fsize <span class="op">=</span> plt.rcParams[<span class="st">'figure.figsize'</span>]</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="fl">2.5</span> <span class="op">*</span> fsize[<span class="dv">0</span>], fsize[<span class="dv">1</span>])</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dqe.astype(<span class="bu">int</span>).plot(ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dqh.astype(<span class="bu">int</span>).plot(ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">0</span>].set_title(<span class="ss">f'Eval, total: </span><span class="sc">{</span>etot<span class="sc">.</span>values<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)<span class="op">;</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">1</span>].set_title(<span class="ss">f'HMC, total: </span><span class="sc">{</span>htot<span class="sc">.</span>values<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)<span class="op">;</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> fig.suptitle(<span class="vs">fr'TensorFlow Improvement: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(etot <span class="op">/</span> htot)<span class="sc">:3.0f}</span><span class="vs">%'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"TensorFlow, EVAL</span><span class="ch">\n</span><span class="ss"> dQint.sum('chain'):</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>dqe<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>(<span class="st">'chain'</span>)<span class="sc">.</span>T<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"dQint.sum(): </span><span class="sc">{</span>dqe<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>T<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"TensorFlow, HMC</span><span class="ch">\n</span><span class="ss"> dQint.sum('chain'):</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>dqh<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>(<span class="st">'chain'</span>)<span class="sc">.</span>T<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"dQint.sum(): </span><span class="sc">{</span>dqh<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>T<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>TensorFlow, EVAL
 dQint.sum('chain'):
 &lt;xarray.DataArray 'dQint' (draw: 90)&gt;
array([13, 22, 11, 25, 14, 19, 20, 25, 13, 19, 22, 18, 10, 10, 15, 12, 17,
       10, 19, 23, 17, 16, 14, 24, 16, 29, 15, 18, 16, 16, 20, 14,  5,  8,
        9, 13, 14, 20, 24, 12, 12, 15, 23, 20,  8, 14, 16, 12, 17, 28, 18,
       19, 18, 12, 27, 16, 24, 14, 21, 20, 19, 14, 14, 21, 22, 11, 22, 17,
       23, 20, 17, 15, 22, 11, 12, 13, 17, 12, 17, 24, 27, 16, 12, 13, 12,
       17, 18, 18, 16, 24])
Coordinates:
  * draw     (draw) int64 110 111 112 113 114 115 ... 194 195 196 197 198 199
dQint.sum(): &lt;xarray.DataArray 'dQint' ()&gt;
array(1527)
TensorFlow, HMC
 dQint.sum('chain'):
 &lt;xarray.DataArray 'dQint' (draw: 90)&gt;
array([ 8,  5,  9,  7, 14, 16, 12, 12, 15, 12, 10, 13, 13, 12,  8, 13, 12,
        3, 11, 12,  7, 12, 10,  6,  8, 16,  8, 17,  8,  9,  7,  1, 10, 12,
       13, 11, 21, 15, 11, 11,  7, 10,  6,  6, 13,  7,  8,  9, 11,  5, 12,
       15, 13, 10,  6, 10,  6,  8,  7,  6, 11, 12, 12, 13,  7, 16,  8, 10,
       14, 17, 11, 11, 13,  9,  9, 11,  9, 11, 13,  9, 11,  9,  7,  4,  6,
        7, 10, 12, 17, 14])
Coordinates:
  * draw     (draw) int64 110 111 112 113 114 115 ... 194 195 196 197 198 199
dQint.sum(): &lt;xarray.DataArray 'dQint' ()&gt;
array(928)</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/c8b406844fffefb775c6beb0e3fc78aa4986f58a.png" class="img-fluid"></p>
</div>
</div>
<div id="6052fa48-6311-4a41-a1f0-4e50ff5145a0" class="cell markdown">
<section id="pytorch-results" class="level3">
<h3 class="anchored" data-anchor-id="pytorch-results">PyTorch Results</h3>
</section>
</div>
<div id="290d8a12-62f3-4d3d-a9d3-8bd8883b3b45" class="cell code" data-execution_count="25" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:36:22.957194Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:36:22.956847Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:36:23.503873Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:36:23.503418Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:36:22.957178Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'notebook'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ndraws <span class="op">=</span> <span class="bu">len</span>(dsets[<span class="st">'pt'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>].draw)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>drop <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.1</span> <span class="op">*</span> ndraws)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.9</span> <span class="op">*</span> ndraws)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>dqe <span class="op">=</span> dsets[<span class="st">'pt'</span>][<span class="st">'eval'</span>][<span class="st">'dQint'</span>][:, <span class="op">-</span><span class="dv">90</span>:]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>dqh <span class="op">=</span> dsets[<span class="st">'pt'</span>][<span class="st">'hmc'</span>][<span class="st">'dQint'</span>][:, <span class="op">-</span><span class="dv">90</span>:]</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>etot <span class="op">=</span> dqe.astype(<span class="bu">int</span>).<span class="bu">sum</span>()</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>htot <span class="op">=</span> dqh.astype(<span class="bu">int</span>).<span class="bu">sum</span>()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>fsize <span class="op">=</span> plt.rcParams[<span class="st">'figure.figsize'</span>]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="fl">2.5</span> <span class="op">*</span> fsize[<span class="dv">0</span>], <span class="fl">0.8</span> <span class="op">*</span> fsize[<span class="dv">1</span>])</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dqe.astype(<span class="bu">int</span>).plot(ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dqh.astype(<span class="bu">int</span>).plot(ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">0</span>].set_title(<span class="ss">f'Eval, total: </span><span class="sc">{</span>etot<span class="sc">.</span>values<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)<span class="op">;</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax[<span class="dv">1</span>].set_title(<span class="ss">f'HMC, total: </span><span class="sc">{</span>htot<span class="sc">.</span>values<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)<span class="op">;</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> fig.suptitle(<span class="vs">fr'PyTorch Improvement: </span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>(etot <span class="op">/</span> htot)<span class="sc">:3.0f}</span><span class="vs">%'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="dv">60</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"PyTorch, EVAL</span><span class="ch">\n</span><span class="ss"> dQint.sum('chain'):</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>dqe<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>(<span class="st">'chain'</span>)<span class="sc">.</span>T<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"dQint.sum(): </span><span class="sc">{</span>dqe<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>T<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="dv">60</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"PyTorch, HMC</span><span class="ch">\n</span><span class="ss"> dQint.sum('chain'):</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>dqh<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>(<span class="st">'chain'</span>)<span class="sc">.</span>T<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>console.<span class="bu">print</span>(<span class="ss">f"dQint.sum(): </span><span class="sc">{</span>dqh<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>T<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output stream stdout">
<pre><code>------------------------------------------------------------
PyTorch, EVAL
 dQint.sum('chain'):
 [26 16 12 23 13 16 39 18 18 18 15 16 27 17 25 16 11 21 20 18 22 21 13 20
 16 19 12 26 17 16 13 17 14 18 15 15 18 23 29 20 17 23 11 16 15 15 19 22
 25 22 19 28 20 20 20 11 24 24 13 15 26 22 14 22 23 23 19 17 21 10 20 14
 16 17 19 11 21 19 15 20 13 16  9 20 21 20 21 22 23 15]
dQint.sum(): 1677
------------------------------------------------------------
PyTorch, HMC
 dQint.sum('chain'):
 [14  6 10  5  7  9 14  8 12 10 19  8  4  6  9  7  9 17  9  7 11 13  9 11
  4  9  7 14 10  6 15  6 10  9 13  7 15 10  7  9  3 14  8  6 11  9  9  6
  9  6 16  6  8 10 14 16  9 12 15 10  9  9  5  6 12 17  6  8  9 12  5 12
 16  9  7  8 11 15 16 12 12  7  5 14  9  9 13  6 12 10]
dQint.sum(): 883</code></pre>
</div>
<div class="output display_data">
<p><img src="assets/b69f7777e9de4b8117074051d295d215dce2c021.png" class="img-fluid"></p>
</div>
</div>
<div id="4700d14c-3ef2-43b3-913a-3ff1c6060664" class="cell markdown">
<section id="comparisons-1" class="level2">
<h2 class="anchored" data-anchor-id="comparisons-1">Comparisons</h2>
</section>
</div>
<div id="c50c4d9b-d6f0-4897-ae0c-caeef5b09b78" class="cell code" data-execution_count="26" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-06-23T20:36:29.465415Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-06-23T20:36:29.465070Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-06-23T20:36:30.957623Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-06-23T20:36:30.957152Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-06-23T20:36:29.465399Z&quot;}" data-tags="[]">
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> l2hmc.utils.plot_helpers <span class="im">import</span> set_plot_style, COLORS</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>set_plot_style()</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.linewidth'</span>] <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">'notebook'</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> plt.rcParamsDefault[<span class="st">'figure.figsize'</span>]</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> plt.rcParamsDefault[<span class="st">'figure.dpi'</span>]</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    fig, (ax, ax1) <span class="op">=</span> plt.subplots(</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        ncols<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#nrows=4,</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        figsize<span class="op">=</span>(<span class="fl">3.</span> <span class="op">*</span> figsize[<span class="dv">0</span>], figsize[<span class="dv">1</span>]),</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.plot(</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>        dsets[<span class="st">'pt'</span>][<span class="st">'eval'</span>].intQ[idx] <span class="op">+</span> <span class="dv">5</span>,  <span class="co"># .dQint.mean('chain')[100:],</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>COLORS[<span class="st">'red'</span>],</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>        ls<span class="op">=</span><span class="st">':'</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'Trained'</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.plot(</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        dsets[<span class="st">'pt'</span>][<span class="st">'hmc'</span>].intQ[idx] <span class="op">-</span> <span class="dv">5</span>,  <span class="co"># .dQint.mean('chain')[100:],</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        ls<span class="op">=</span><span class="st">'-'</span>,</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'HMC'</span>,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'#666666'</span>,</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.plot(</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>        dsets[<span class="st">'tf'</span>][<span class="st">'eval'</span>].intQ[idx] <span class="op">+</span> <span class="dv">5</span>,  <span class="co"># .dQint.mean('chain')[-100:],</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>COLORS[<span class="st">'blue'</span>],</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>        ls<span class="op">=</span><span class="st">':'</span>,</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'Trained'</span>,</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.plot(</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>        dsets[<span class="st">'tf'</span>][<span class="st">'hmc'</span>].intQ[idx] <span class="op">-</span> <span class="dv">5</span>,  <span class="co"># .dQint.mean('chain')[-100:],</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'#666666'</span>,</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>        ls<span class="op">=</span><span class="st">'-'</span>,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'HMC'</span>,</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        lw<span class="op">=</span><span class="fl">2.0</span>,</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.set_title(<span class="st">'PyTorch'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.set_title(<span class="st">'TensorFlow'</span>, fontsize<span class="op">=</span><span class="st">'x-large'</span>)</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">#_ = ax1.set_ylim(ax.get_ylim())</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.set_xlabel(<span class="st">'MD Step'</span>, fontsize<span class="op">=</span><span class="st">'large'</span>)</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.set_xlabel(<span class="st">'MD Step'</span>, fontsize<span class="op">=</span><span class="st">'large'</span>)</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.set_ylabel(<span class="st">'dQint'</span>, fontsize<span class="op">=</span><span class="st">'large'</span>)</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.legend(loc<span class="op">=</span><span class="st">'best'</span>, ncol<span class="op">=</span><span class="dv">2</span>, labelcolor<span class="op">=</span><span class="st">'#939393'</span>)</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax1.legend(loc<span class="op">=</span><span class="st">'best'</span>, ncol<span class="op">=</span><span class="dv">2</span>, labelcolor<span class="op">=</span><span class="st">'#939393'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="output display_data">
<p><img src="assets/10243389b553ab7b6d7a7a8ff3cd6754693a67cf.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4b7098bd4f2f7e5b30634231745bc6c23040553e.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/aebda149e7192a347673532f646f91c13b3fdcb6.png" class="img-fluid"></p>
</div>
<div class="output display_data">
<p><img src="assets/4a952c94b9203ad5e0adbabee00709b0b92f0baf.png" class="img-fluid"></p>
</div>
</div>
<div id="3e7a59ba-276f-4199-90b5-30aa847bb3b2" class="cell code">
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{foreman2023,
  author = {Foreman, Sam},
  title = {2D {\$U(1)\$} {Model}},
  date = {2023-10-04},
  url = {https://saforem2.github.io/l2hmc-qcd/qmd/l2hmc-4DSU3.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-foreman2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Foreman, Sam. 2023. <span>“2D $U(1)$ Model.”</span> October 4, 2023. <a href="https://saforem2.github.io/l2hmc-qcd/qmd/l2hmc-4DSU3.html">https://saforem2.github.io/l2hmc-qcd/qmd/l2hmc-4DSU3.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/saforem2/l2hmc-qcd">l2hmc-qcd</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">Copyright 2023, Sam Foreman</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://samforeman.me"><i class="fa-solid fa-home" aria-label="home"></i></a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/saforem2">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/saforem2">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="mailto:///foremans@anl.gov"><i class="fa-regular fa-paper-plane" aria-label="paper-plane"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://www.twitter.com/saforem2"><i class="fa-brands fa-twitter" aria-label="twitter"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=vV_1zDwAAAAJ&amp;hl=en"><i class="ai  ai-google-scholar"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0002-9981-0876"><i class="ai  ai-orcid"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://www.last.fm/user/saforem2"><i class="fa-brands fa-lastfm" aria-label="lastfm"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://open.spotify.com/user/saforem2"><i class="fa-brands fa-spotify" aria-label="spotify"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://www.instagram.com/saforem2"><i class="fa-brands fa-instagram" aria-label="instagram"></i></a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://linkedin.com/in/saforem2"><i class="fa-brands fa-linkedin" aria-label="linkedin"></i></a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>